
<textarea name="code" class="java" style="display:none;">

private boolean showPreview = true;

//setup renderers as member variables
private Renderer renderTopic = new Renderer() {
    public String render(Object value, Record record, int rowIndex, int colNum) {
        return Format.format("<b>{0}</b>{1}", new String[]{(String) value, record.getAsString("excerpt")});
    }
};

private Renderer renderTopicPlain = new Renderer() {
    public String render(Object value, Record record, int rowIndex, int colNum) {
        return Format.format("<b><i>{0}</i></b>", new String[]{(String) value});
    }
};

private Renderer renderLast = new Renderer() {
    public String render(Object value, Record record, int rowIndex, int colNum) {
        Date lastPost = record.getAsDate("lastPost");
        String lastPostStr = DateUtil.format(lastPost, "M j, Y, g:i a");
        return Format.format("{0}<br/>by {1}", new String[]{lastPostStr, record.getAsString("author")});
    }
};

private Renderer renderLastPlain = new Renderer() {
    public String render(Object value, Record record, int rowIndex, int colNum) {
        Date lastPost = record.getAsDate("lastPost");
        return DateUtil.format(lastPost, "M j, Y, g:i a");
    }
};

...
...

// grid creation
DataProxy dataProxy = new ScriptTagProxy("http://extjs.com/forum/topics-remote.php");

JsonReader reader = new JsonReader(new JsonReaderConfig() {
    {
        setRoot("topics");
        setTotalProperty("totalCount");
        setId("post_id");
    }
}, new RecordDef(new Field[]{
        new StringField("title", "topic_title"),
        new StringField("author", "username"),
        new IntegerField("totalPosts", "topic_replies"),
        new DateField("lastPost", "post_time", "timestamp"),
        new StringField("lastPoster", "user2"),
        new StringField("excerpt", "post_text")
}));

final Store store = new Store(dataProxy, reader, true);
store.setDefaultSort("lastPost", "DESC");
store.load();

ColumnModel columnModel = new ColumnModel(new ColumnConfig[]{
        new ColumnConfig() {
            {
                setId("topic");
                setHeader("Topic");
                setDataIndex("title");
                setWidth(420);
                setRenderer(getTopicRenderer());
                setCss("white-space:normal;");
            }
        },
        new ColumnConfig() {
            {
                setHeader("Author");
                setDataIndex("author");
                setWidth(100);
                setHidden(true);
            }
        },
        new ColumnConfig() {
            {
                setId("last");
                setHeader("Last Post");
                setDataIndex("lastPost");
                setWidth(150);
                setRenderer(getLastRenderer());
                setSortable(true);
            }
        }
});

columnModel.setDefaultSortable(true);

grid = new Grid("topic-grid", "600px", "300px", store, columnModel, new GridConfig() {
    {
        setEnableColLock(false);
        setLoadMask(true);
    }
});

grid.render();

ExtElement gridFoot = grid.getView().getFooterPanel(true);

PagingToolbar pagingToolbar = new PagingToolbar(gridFoot, store, new PagingToolbarConfig() {
    {
        setPageSize(25);
        setDisplayInfo(true);
        setDisplayMsg("Displaying topics {0} - {1} of {2}");
        setEmptyMsg("No topics to display");
    }
});

pagingToolbar.addSeparator();
pagingToolbar.addButton(new ToolbarButton("Detailed View", new ButtonConfig() {
    {
        setPressed(showPreview);
        setEnableToggle(true);
        setCls("x-btn-text-icon details");
        setButtonListener(new ButtonListenerAdapter() {
            public void onToggle(Button button, boolean pressed) {
                togglePreview(pressed);
            }
        });
    }
}));

store.load(new StoreLoadConfig() {
    {
        setParams(new UrlParam[]{
                new UrlParam("start", 0),
                new UrlParam("limit", 25)
        });
    }
});

...
...
// methods for altering the appearance of the grid
private Renderer getTopicRenderer() {
    if (showPreview) {
        return renderTopic;
    } else {
        return renderTopicPlain;
    }
}

private Renderer getLastRenderer() {
    if (showPreview) {
        return renderLast;
    } else {
        return renderLastPlain;
    }
}

private void togglePreview(boolean pressed) {
    showPreview = pressed;
    grid.getColumnModel().setRenderer(0, getTopicRenderer());
    grid.getColumnModel().setRenderer(3, getLastRenderer());
    grid.getView().refresh();
}
</textarea>


<script class="javascript">
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
